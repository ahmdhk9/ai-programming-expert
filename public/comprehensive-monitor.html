<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ”¥ Comprehensive Error Monitor</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: linear-gradient(135deg, #0f1419 0%, #1a1f2e 100%);
      color: #00d4ff;
      font-family: 'Segoe UI', Tahoma, sans-serif;
      padding: 20px;
      min-height: 100vh;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    h1 { margin-bottom: 20px; font-size: 28px; text-align: center; }
    .header {
      background: rgba(0, 212, 255, 0.1);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      border: 1px solid #00d4ff30;
    }
    .health-score {
      font-size: 48px;
      font-weight: bold;
      text-align: center;
      margin: 20px 0;
    }
    .controls {
      display: flex;
      gap: 10px;
      margin: 20px 0;
      flex-wrap: wrap;
      justify-content: center;
    }
    button {
      background: #00d4ff;
      color: #0f1419;
      border: none;
      padding: 10px 15px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
    }
    button:hover { background: #00e5ff; transform: translateY(-2px); }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .card {
      background: #1a1f2e;
      border: 1px solid #00d4ff20;
      border-radius: 10px;
      padding: 20px;
      transition: all 0.3s;
    }
    .card:hover {
      border-color: #00d4ff;
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
    }
    .card h3 {
      margin-bottom: 15px;
      color: #00e5ff;
      border-bottom: 2px solid #00d4ff30;
      padding-bottom: 10px;
    }
    .metric {
      display: flex;
      justify-content: space-between;
      margin: 8px 0;
      padding: 8px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 6px;
    }
    .metric-value {
      font-weight: bold;
      color: #4ade80;
    }
    .issues-container {
      background: #1a1f2e;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 30px;
      border: 1px solid #00d4ff20;
    }
    .issues-list {
      max-height: 600px;
      overflow-y: auto;
    }
    .issue {
      background: rgba(0, 0, 0, 0.3);
      padding: 12px;
      margin: 8px 0;
      border-radius: 6px;
      border-left: 4px solid;
      cursor: pointer;
      transition: all 0.2s;
    }
    .issue:hover {
      background: rgba(0, 212, 255, 0.1);
      transform: translateX(5px);
    }
    .issue.critical { border-left-color: #ff0000; }
    .issue.high { border-left-color: #ff9800; }
    .issue.medium { border-left-color: #ffc107; }
    .issue.info { border-left-color: #2196F3; }
    .issue-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 5px;
    }
    .issue-category {
      display: inline-block;
      background: rgba(0, 212, 255, 0.2);
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
    }
    .issue-count {
      background: #ff6b6b;
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
    }
    .issue-message { color: #ddd; margin: 8px 0; }
    .issue-time { font-size: 12px; opacity: 0.6; }
    .empty {
      text-align: center;
      color: #666;
      padding: 40px 20px;
    }
    .summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    .summary-item {
      background: rgba(0, 212, 255, 0.1);
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      border: 1px solid #00d4ff30;
    }
    .summary-item strong {
      display: block;
      font-size: 24px;
      margin-bottom: 5px;
    }
    .summary-item small {
      display: block;
      opacity: 0.7;
      font-size: 12px;
    }
    .recommendations {
      background: rgba(76, 222, 196, 0.1);
      padding: 15px;
      border-radius: 8px;
      border-left: 4px solid #4ade80;
      margin-top: 20px;
    }
    .recommendation {
      margin: 10px 0;
      padding: 10px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 6px;
    }
    .severity-critical { color: #ff0000; }
    .severity-high { color: #ff9800; }
    .severity-medium { color: #ffc107; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”¥ Comprehensive Error Monitor</h1>
    
    <div class="header">
      <div class="health-score" id="health-score">ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...</div>
      <div style="text-align: center; color: #888; font-size: 14px;">
        Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: <span id="last-update">Ø§Ù„Ø¢Ù†</span>
      </div>
    </div>

    <div class="controls">
      <button onclick="refreshReport()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ­Øµ</button>
      <button onclick="autoRefresh()">âš¡ ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ</button>
      <button onclick="exportReport()">ğŸ“¥ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
      <button onclick="clearIssues()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„</button>
    </div>

    <div class="summary" id="summary">
      <div class="summary-item">
        <strong id="total-issues">0</strong>
        <small>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„</small>
      </div>
      <div class="summary-item">
        <strong id="critical-count" style="color: #ff0000;">0</strong>
        <small>Ù…Ø´Ø§ÙƒÙ„ Ø­Ø±Ø¬Ø©</small>
      </div>
      <div class="summary-item">
        <strong id="high-count" style="color: #ff9800;">0</strong>
        <small>Ù…Ø´Ø§ÙƒÙ„ Ø¹Ø§Ù„ÙŠØ©</small>
      </div>
      <div class="summary-item">
        <strong id="medium-count" style="color: #ffc107;">0</strong>
        <small>Ù…Ø´Ø§ÙƒÙ„ Ù…ØªÙˆØ³Ø·Ø©</small>
      </div>
    </div>

    <div class="grid" id="metrics-grid">
      <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ù…Ù† JavaScript -->
    </div>

    <div class="issues-container">
      <h2>ğŸ“‹ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù…ÙƒØªØ´ÙØ©</h2>
      <div class="issues-list" id="issues-list">
        <div class="empty">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø´Ø§Ù…Ù„...</div>
      </div>
    </div>

    <div class="recommendations" id="recommendations">
      <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ù…Ù† JavaScript -->
    </div>
  </div>

  <script>
    let autoRefreshInterval = null;

    async function loadReport() {
      if (!window.advancedMonitor) {
        console.warn('Advanced Monitor not available');
        setTimeout(loadReport, 500);
        return;
      }

      const report = window.advancedMonitor.getFullReport();
      displayReport(report);
      document.getElementById('last-update').textContent = 
        new Date().toLocaleTimeString('ar-SA');
    }

    function displayReport(report) {
      // Health Score
      const health = report.health;
      document.getElementById('health-score').innerHTML = 
        `${health.status}<br><strong>${health.score}/100</strong>`;

      // Summary
      const summary = report.summary;
      document.getElementById('total-issues').textContent = summary.totalIssues;
      document.getElementById('critical-count').textContent = summary.critical;
      document.getElementById('high-count').textContent = summary.high;
      document.getElementById('medium-count').textContent = summary.medium;

      // Metrics Grid
      displayMetrics(report.metrics);

      // Issues List
      displayIssues(report.issues);

      // Recommendations
      displayRecommendations(report.recommendations);
    }

    function displayMetrics(metrics) {
      const grid = document.getElementById('metrics-grid');
      grid.innerHTML = '';

      const sections = [
        {
          title: 'âš¡ Ø§Ù„Ø£Ø¯Ø§Ø¡',
          data: metrics.performance,
          format: (k, v) => `${k}: ${v}ms`
        },
        {
          title: 'ğŸ§  Ø§Ù„Ø°Ø§ÙƒØ±Ø©',
          data: metrics.memory,
          format: (k, v) => {
            if (k === 'percentage') return `${k}: ${v}%`;
            if (k === 'used' || k === 'limit') return `${k}: ${v}MB`;
            return `${k}: ${v}`;
          }
        },
        {
          title: 'ğŸ“¡ Ø§Ù„Ø´Ø¨ÙƒØ©',
          data: metrics.network,
          format: (k, v) => `${k}: ${v}`
        },
        {
          title: 'ğŸ”Œ Socket.IO',
          data: metrics.socket,
          format: (k, v) => {
            if (k === 'connected') return `Ù…ØªØµÙ„: ${v ? 'âœ…' : 'âŒ'}`;
            return `${k}: ${v}`;
          }
        }
      ];

      sections.forEach(section => {
        if (Object.keys(section.data).length === 0) return;

        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `<h3>${section.title}</h3>`;

        Object.entries(section.data).forEach(([key, value]) => {
          if (key !== 'timestamp') {
            const metric = document.createElement('div');
            metric.className = 'metric';
            metric.innerHTML = `
              <span>${key}</span>
              <span class="metric-value">${section.format(key, value)}</span>
            `;
            card.appendChild(metric);
          }
        });

        grid.appendChild(card);
      });
    }

    function displayIssues(issues) {
      const list = document.getElementById('issues-list');
      
      if (issues.length === 0) {
        list.innerHTML = '<div class="empty">âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§ÙƒÙ„ - ÙƒÙ„ Ø´ÙŠØ¡ ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ù…Ù…ØªØ§Ø²!</div>';
        return;
      }

      list.innerHTML = issues.map(issue => `
        <div class="issue ${issue.severity}" onclick="showIssueDetail(${issues.indexOf(issue)})">
          <div class="issue-header">
            <div>
              <span class="issue-category">${issue.category}</span>
              ${issue.count > 1 ? `<span class="issue-count">Ã—${issue.count}</span>` : ''}
            </div>
            <div class="issue-time">${new Date(issue.timestamp).toLocaleTimeString('ar-SA')}</div>
          </div>
          <div class="issue-message"><strong>${issue.message}</strong></div>
          <div style="font-size: 12px; opacity: 0.6; text-transform: uppercase;">
            Ø§Ù„Ø®Ø·ÙˆØ±Ø©: <span class="severity-${issue.severity}">${issue.severity}</span>
          </div>
        </div>
      `).join('');
    }

    function displayRecommendations(recommendations) {
      const container = document.getElementById('recommendations');
      
      if (recommendations.length === 0) {
        container.style.display = 'none';
        return;
      }

      container.style.display = 'block';
      container.innerHTML = '<h2>ğŸ’¡ Ø§Ù„ØªÙˆØµÙŠØ§Øª</h2>';
      
      recommendations.forEach(rec => {
        const div = document.createElement('div');
        div.className = 'recommendation';
        div.textContent = rec;
        container.appendChild(div);
      });
    }

    function showIssueDetail(index) {
      if (!window.advancedMonitor) return;
      const issues = window.advancedMonitor.issues;
      const issue = issues[index];
      alert(`ğŸ“Š ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:\n\nØ§Ù„ÙØ¦Ø©: ${issue.category}\nØ§Ù„Ø±Ø³Ø§Ù„Ø©: ${issue.message}\nØ§Ù„Ø®Ø·ÙˆØ±Ø©: ${issue.severity}\nØ§Ù„ØªÙƒØ±Ø§Ø±: ${issue.count}\nØ§Ù„ÙˆÙ‚Øª: ${new Date(issue.timestamp).toLocaleString('ar-SA')}`);
    }

    function refreshReport() {
      loadReport();
    }

    function autoRefresh() {
      if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
        autoRefreshInterval = null;
        console.log('â¸ï¸ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ');
      } else {
        autoRefreshInterval = setInterval(loadReport, 3000);
        console.log('â–¶ï¸ ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ');
      }
    }

    function exportReport() {
      if (window.advancedMonitor) {
        window.advancedMonitor.exportReport();
      }
    }

    function clearIssues() {
      if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©ØŸ')) {
        localStorage.removeItem('monitor_issues');
        if (window.advancedMonitor) {
          window.advancedMonitor.issues = [];
          loadReport();
        }
      }
    }

    // Load on page open
    setTimeout(loadReport, 1000);
    
    // Auto-refresh every 5 seconds
    setInterval(loadReport, 5000);
  </script>
</body>
</html>
