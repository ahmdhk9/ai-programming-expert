name: ğŸš€ Auto Deploy to Vercel & Fly.io

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: âœ… Checkout
        uses: actions/checkout@v3

      - name: ğŸ”” Trigger Vercel Deployment
        env:
          VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
          VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
          VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}
        run: |
          echo "ğŸš€ Ø¥Ø¹Ø§Ø¯Ø© Ù†Ø´Ø± Ø¹Ù„Ù‰ Vercel..."
          curl -X POST \
            -H "Authorization: Bearer $VERCEL_TOKEN" \
            "https://api.vercel.com/v13/deployments" \
            -H "Content-Type: application/json" \
            -d "{
              \"gitSource\":{
                \"type\":\"github\",
                \"ref\":\"main\",
                \"owner\":\"ahmdhk9\",
                \"repo\":\"ai-programming-expert\",
                \"repoId\":\"$VERCEL_ORG_ID\"
              }
            }"
          echo "âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ù†Ø´Ø± Ø¥Ù„Ù‰ Vercel"

      - name: ğŸ”” Trigger Fly.io Deployment
        env:
          FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}
        run: |
          echo "ğŸš€ Ø¥Ø¹Ø§Ø¯Ø© Ù†Ø´Ø± Ø¹Ù„Ù‰ Fly.io..."
          curl -X POST \
            -H "Authorization: Bearer $FLY_API_TOKEN" \
            "https://api.fly.io/graphql" \
            -d '{"query":"mutation{createRelease(input:{appId:\"ai-programming-expert\",strategy:ROLLING}){release{id}}}"}' \
            -H "Content-Type: application/json"
          echo "âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ù†Ø´Ø± Ø¥Ù„Ù‰ Fly.io"

      - name: ğŸ“Š Notification
        run: |
          echo "âœ… ØªÙ… ÙØ¹Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©:"
          echo "   âœ“ GitHub: ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯"
          echo "   âœ“ Vercel: Ù‚ÙŠØ¯ Ø§Ù„Ù†Ø´Ø±"
          echo "   âœ“ Fly.io: Ù‚ÙŠØ¯ Ø§Ù„Ù†Ø´Ø±"