name: ğŸ”„ Webhook Monitor & Sync

on:
  schedule:
    # ÙØ­Øµ ÙƒÙ„ 30 Ø¯Ù‚ÙŠÙ‚Ø©
    - cron: '*/30 * * * *'
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: âœ… Checkout
        uses: actions/checkout@v3

      - name: ğŸ” Check if sync needed
        id: check
        run: |
          GITHUB_SHA=$(git rev-parse HEAD)
          echo "current_sha=$GITHUB_SHA" >> $GITHUB_OUTPUT
          echo "âœ“ Ø¢Ø®Ø± commit: $GITHUB_SHA"

      - name: ğŸ”„ Force Vercel Sync
        env:
          VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
        run: |
          curl -s -X POST \
            -H "Authorization: Bearer $VERCEL_TOKEN" \
            "https://api.vercel.com/v13/deployments" \
            -H "Content-Type: application/json" \
            -d "{
              \"gitSource\":{
                \"type\":\"github\",
                \"ref\":\"main\",
                \"owner\":\"ahmdhk9\",
                \"repo\":\"ai-programming-expert\"
              }
            }" > /dev/null
          echo "âœ… Vercel sync triggered"

      - name: ğŸ”„ Force Fly.io Sync
        env:
          FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}
        run: |
          curl -s -X POST \
            -H "Authorization: Bearer $FLY_API_TOKEN" \
            "https://api.fly.io/graphql" \
            -d '{"query":"mutation{createRelease(input:{appId:\"ai-programming-expert\",strategy:ROLLING}){release{id}}}"}' \
            -H "Content-Type: application/json" > /dev/null
          echo "âœ… Fly.io sync triggered"

      - name: ğŸ“Š Status Report
        run: |
          echo "âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ù„ÙØ­Øµ ÙˆØ§Ù„ØªØ²Ø§Ù…Ù†:"
          echo "   âœ“ GitHub: Ù…Ø­Ø¯Ø«"
          echo "   âœ“ Vercel: ØªØ²Ø§Ù…Ù† ØªÙ„Ù‚Ø§Ø¦ÙŠ"
          echo "   âœ“ Fly.io: ØªØ²Ø§Ù…Ù† ØªÙ„Ù‚Ø§Ø¦ÙŠ"